#!/usr/bin/python3

import os
import importlib
import questionary
import platform

# Importing the colors
from src.colors import get_color

BANNER: str = """
\033[91m
        ███████╗    ██████╗ ███████╗███╗   ██╗████████╗███████╗███████╗████████╗
        ██╔════╝    ██╔══██╗██╔════╝████╗  ██║╚══██╔══╝██╔════╝██╔════╝╚══██╔══╝
        █████╗█████╗██████╔╝█████╗  ██╔██╗ ██║   ██║   █████╗  ███████╗   ██║   
        ██╔══╝╚════╝██╔═══╝ ██╔══╝  ██║╚██╗██║   ██║   ██╔══╝  ╚════██║   ██║   
        ██║         ██║     ███████╗██║ ╚████║   ██║   ███████╗███████║   ██║   
        ╚═╝         ╚═╝     ╚══════╝╚═╝  ╚═══╝   ╚═╝   ╚══════╝╚══════╝   ╚═╝   
\033[0m
"""

def list_tools():
    tools_dir = './src/tools'
    tools = [f.replace('.py', '') for f in os.listdir(tools_dir) if f.endswith('.py')]
    return tools

def import_tool(tool_name: str):
    tool_path = f"src.tools.{tool_name}"
    tool = importlib.import_module(tool_path)
    return tool

def clear_screen():
    if platform.system() == "Windows":
        os.system("cls")
    else:
        os.system("clear")

def display_banner():
    print(f"\t {BANNER}")

def display_info():
    print(f"\t {get_color('RED')}[!] {get_color('WHITE')}This tool is coded to facilitate penetration testing. Do not use this tool for illegal purposes!")
    print(f"\t {get_color('GREEN')}[+] {get_color('WHITE')}Developer: @OsmanTunahan")
    print(f"\t {get_color('GREEN')}[+] {get_color('WHITE')}Version: v0.2")
    print(f"")
    print("\n")

def display_tools(tools: list):
    choices = [f"{i + 1}. {tool}" for i, tool in enumerate(tools)]
    return questionary.select("Tool you want to use:", choices=choices).ask()

def main():
    clear_screen()
    display_banner()
    display_info()

    tools = list_tools()
    tool_choice = display_tools(tools)
    if not tool_choice:
        print(f"{get_color('RED')}* {get_color('WHITE')}No tool selected! Exiting...")
        return

    tool_index = int(tool_choice.split('.')[0]) - 1
    tool_name = tools[tool_index]
    tool = import_tool(tool_name)
    tool.run()

if __name__ == "__main__":
    main()